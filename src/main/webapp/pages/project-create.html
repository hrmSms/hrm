<!-- page specific plugin styles -->
<!-- <link rel="stylesheet" href="../../assets/css/jquery-ui.custom.css" /> -->

<!-- page specific plugin styles -->
<link rel="stylesheet" href="assets/css/jquery-ui.custom.min.css" />
<link rel="stylesheet" href="assets/css/bootstrap-datetimepicker.min.css" />


<!-- /section:basics/navbar.layout -->
<div class="main-container" id="main-container">
  <div class="row">
    <div class="col-xs-12 page-header">
      <div class="pull-left">        
        <div class="padding-left-50px">
          <h4>Create project</h4>
        </div>
      </div>

    </div>
    <div ng-show="success" class="col-xs-12 center" id="success">
      <div class="alert alert-success">{{success}}</div>
    </div>
    <div class="col-xs-12">

      <form name="form" class="form-horizontal">
        <div class="form-group">
          	<label class="col-sm-2 control-label no-padding-right" > Name <i class="red">*</i></label>
  	        <div class="col-sm-8 col-xs-10">
				<input type="text" ng-model="p.name" name="projectname"	class="form-control" required projectname-validator/>
  					<div ng-if="form.projectname.$dirty" >
						<div ng-messages="form.projectname.$error"	 >
							<div ng-message="required" class="alert alert-danger" >Project name required</div>
							<div ng-message="projectname" class="alert alert-danger">The project name already existed. Please input another name</div>
						</div>
						<div ng-messages="form.projectname.$pending" >
							<div ng-message="projectname" class="alert alert-info">Checking project name is unique...</div>
						</div>
					</div>
          	</div>
        </div>

        <div class="form-group ">
          <label class="col-sm-2 control-label no-padding-right" for="description"> Description </label>
          <div class="col-sm-8 col-sx-10">
            <div class="wysiwyg-editor" id="description" ></div>
          </div>
        </div>
		
		<div class="form-group">
          <label class="col-sm-2 control-label no-padding-right" for="name"> Client </label>
          <div class="col-sm-8 col-xs-10">
            <div ng-class="{ 'has-error': form.name.$touched && form.name.$invalid }">
              <input type="number" min="1" id="client" name="client" class="form-control" ng-model="p.clientId" />
            </div>            
          </div>
        </div>

        <div class="form-group">
          <label class="col-sm-2 control-label no-padding-right" for="startDate">Start Date <i class="red">*</i></label>
          <div class="col-sm-3 col-xs-8">
            <div class="input-group" ng-class="{ 'has-error': form.startDate.$touched && form.startDate.$invalid }">
              <input id="startDate" name="startDate" type="text" class="form-control" ng-model="p.startDate"
                lower-than="{{p.endDate}}" show-error="{{form.endDate.$error.higherThan}}" required /> <span
                class="input-group-addon"> <i class="fa fa-clock-o bigger-110"></i>
              </span>
            </div>
            <div ng-show="form.$submitted || form.startDate.$dirty">
              <div ng-show="!error.startDate">
                <div ng-show="form.startDate.$error.required" class="alert alert-danger">Start Date isn't null</div>
                <div ng-show="form.startDate.$error.lowerThan" class="alert alert-danger">Start Date should be
                  less than End Date</div>
              </div>
              <div ng-show="error.startDate" class="alert alert-danger">{{error.startDate}}</div>
            </div>
          </div>
          <label class="col-sm-2 control-label no-padding-right" for="endDate">End Date <i class="red">*</i></label>
          <div class="col-sm-3  col-xs-8">
            <div class="input-group" ng-class="{ 'has-error': form.endDate.$touched && form.endDate.$invalid }">
              <input id="endDate" name="endDate" type="text" class="form-control" ng-model="p.endDate"
                higher-than="{{p.startDate}}" show-error="{{form.startDate.$error.lowerThan}}" required /> <span
                class="input-group-addon"> <i class="fa fa-clock-o bigger-110"></i>
              </span>
            </div>
            <div ng-show="form.$submitted || form.endDate.$dirty">
              <div ng-show="!error.endDate">
                <div ng-show="form.endDate.$error.required" class="alert alert-danger">End Date isn't null</div>
                <div ng-show="form.endDate.$error.higherThan" class="alert alert-danger">End Date should be
                  greater than Start Date</div>
              </div>
            </div>
            <div ng-show="error.endDate" class="alert alert-danger">{{error.endDate}}</div>
          </div>
        </div>

        <div class="center clearfix">
          <hrm-button type="save" ng-disabled="!form.$valid" ng-click="createAndClose()"></hrm-button>
          <hrm-button type="reset" ng-click="reset(form)" data-ng-if="action == 0"></hrm-button>
          <hrm-button type="close" ng-click="goToProjectList()"></hrm-button>          
        </div>

      </form>
    </div>
  </div>
</div>
<!-- /.main-container -->

<!-- inline scripts related to this page -->
<script type="text/javascript">
  jQuery(function($) {
    // init theme
    //ace.init.start();
  });
  var initAll = function() {
    //datetimepicker plugin
    $('#startDate').datetimepicker({
      format : 'DD-MM-YYYY'
    }).next().on(ace.click_event, function(e) {
      $(this).prev().focus();
      //$(this).data("DateTimePicker").minDate(date());
    });

    $('#endDate').datetimepicker({
      format : 'DD-MM-YYYY'
    }).next().on(ace.click_event, function(e) {
      $(this).prev().focus();
    });

    //description texterea
    $('#description').css({
      'height' : '150px'
    }).ace_wysiwyg();

    var toolbar = $('#description').prev().get(0);
    $(toolbar).addClass('wysiwyg-style2');

    //note texterea
    $('#note').css({
      'height' : '150px'
    }).ace_wysiwyg();

    var toolbar = $('#note').prev().get(0);
    $(toolbar).addClass('wysiwyg-style2');

    //RESIZE IMAGE

    //Add Image Resize Functionality to Chrome and Safari
    //webkit browsers don't have image resize functionality when content is editable
    //so let's add something using jQuery UI resizable
    //another option would be opening a dialog for user to enter dimensions.
    if (typeof jQuery.ui !== 'undefined' && ace.vars['webkit']) {

      var lastResizableImg = null;
      function destroyResizable() {
        if (lastResizableImg == null)
          return;
        lastResizableImg.resizable("destroy");
        lastResizableImg.removeData('resizable');
        lastResizableImg = null;
      }

      var enableImageResize = function() {
        $('.wysiwyg-editor').on('mousedown', function(e) {
          var target = $(e.target);
          if (e.target instanceof HTMLImageElement) {
            if (!target.data('resizable')) {
              target.resizable({
                aspectRatio : e.target.width / e.target.height,
              });
              target.data('resizable', true);

              if (lastResizableImg != null) {
                //disable previous resizable image
                lastResizableImg.resizable("destroy");
                lastResizableImg.removeData('resizable');
              }
              lastResizableImg = target;
            }
          }
        }).on('click', function(e) {
          if (lastResizableImg != null && !(e.target instanceof HTMLImageElement)) {
            destroyResizable();
          }
        }).on('keydown', function() {
          destroyResizable();
        });
      }

      enableImageResize();

      
    }

  };
</script>

<!-- page specific plugin scripts -->
<script type="text/javascript">
  var scripts = [ null, './assets/js/date-time/bootstrap-datetimepicker.min.js',
      './assets/js/bootstrap-wysiwyg.min.js', './assets/js/bootbox.min.js',
      './assets/js/app/ng/shared/jquery.bpopup.min.js', './assets/js/bootbox.min.js', null ]; //[null, './assets/js/jquery-ui.custom.js', './assets/js/bootbox.js', null]
  $('.page-content-area').ace_ajax('loadScripts', scripts, function() {
    //inline scripts related to this page
    initAll();
  });
</script>
